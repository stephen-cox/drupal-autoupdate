<?xml version='1.1' encoding='UTF-8'?>
<hudson.plugins.promoted__builds.PromotionProcess plugin="promoted-builds@3.1">
  <keepDependencies>false</keepDependencies>
  <properties/>
  <scm class="hudson.scm.NullSCM"/>
  <canRoam>true</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers/>
  <concurrentBuild>false</concurrentBuild>
  <conditions>
    <hudson.plugins.promoted__builds.conditions.ManualCondition>
      <users></users>
      <parameterDefinitions/>
    </hudson.plugins.promoted__builds.conditions.ManualCondition>
  </conditions>
  <icon>star-gold</icon>
  <assignedLabel>S18-VM-APP-T142</assignedLabel>
  <isVisible></isVisible>
  <buildSteps>
    <hudson.tasks.Shell>
      <command>#!/bin/bash

#
# Finalise the hotfix containing updates
#

echo &quot;[Task] Attempting to finalise hotfix&quot;

cd /var/www/{{ item.name }}/gitroot

# Check git branch
BRANCH=$(git symbolic-ref --short -q HEAD)
if [[ ! &quot;${BRANCH}&quot;  =~ ^hotfix.* ]]; then
  echo &quot;[Task] Git is not a on a hotfix branch&quot;
  exit 1
fi

# Finalise hotfix
git checkout master
git merge --no-ff ${BRANCH}
git checkout develop
git merge --no-ff ${BRANCH}
git branch -d ${BRANCH}
git push origin --delete ${BRANCH}
git push origin master
git push origin develop

echo &quot;[Task] Hotfix finalised and branch deleted&quot;
</command>
    </hudson.tasks.Shell>
  </buildSteps>
</hudson.plugins.promoted__builds.PromotionProcess>
\ No newline at end of file
